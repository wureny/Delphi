{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://delphi.local/schemas/fund-execution-ontology.schema.json",
  "title": "Delphi Fund Execution Ontology Bundle",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "schema_version",
    "generated_at",
    "portfolio_accounts",
    "positions",
    "orders",
    "executions",
    "wallets",
    "risk_policies",
    "decision_records"
  ],
  "properties": {
    "schema_version": {
      "type": "string",
      "pattern": "^v[0-9]+\\.[0-9]+$"
    },
    "generated_at": {
      "type": "string",
      "format": "date-time"
    },
    "portfolio_accounts": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/PortfolioAccount"
      }
    },
    "positions": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/Position"
      }
    },
    "orders": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/Order"
      }
    },
    "executions": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/Execution"
      }
    },
    "wallets": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/Wallet"
      }
    },
    "risk_policies": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/RiskPolicy"
      }
    },
    "decision_records": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/DecisionRecord"
      }
    }
  },
  "$defs": {
    "PortfolioAccount": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "id",
        "name",
        "base_currency",
        "status",
        "risk_policy_id"
      ],
      "properties": {
        "id": {"type": "string", "minLength": 1},
        "name": {"type": "string", "minLength": 1},
        "base_currency": {"type": "string", "minLength": 1},
        "status": {"type": "string", "enum": ["active", "paused", "archived"]},
        "risk_policy_id": {"type": "string", "minLength": 1}
      }
    },
    "Position": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "id",
        "portfolio_id",
        "market_id",
        "outcome_id",
        "side",
        "size",
        "avg_entry_price",
        "mark_price",
        "unrealized_pnl",
        "status"
      ],
      "properties": {
        "id": {"type": "string", "minLength": 1},
        "portfolio_id": {"type": "string", "minLength": 1},
        "market_id": {"type": "string", "minLength": 1},
        "outcome_id": {"type": "string", "minLength": 1},
        "side": {"type": "string", "enum": ["long", "short"]},
        "size": {"type": "number", "minimum": 0},
        "avg_entry_price": {"type": "number", "minimum": 0},
        "mark_price": {"type": "number", "minimum": 0},
        "unrealized_pnl": {"type": "number"},
        "status": {"type": "string", "enum": ["open", "closed"]}
      }
    },
    "Order": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "id",
        "portfolio_id",
        "market_id",
        "outcome_id",
        "side",
        "order_type",
        "quantity",
        "status",
        "decision_record_id"
      ],
      "properties": {
        "id": {"type": "string", "minLength": 1},
        "portfolio_id": {"type": "string", "minLength": 1},
        "market_id": {"type": "string", "minLength": 1},
        "outcome_id": {"type": "string", "minLength": 1},
        "side": {"type": "string", "enum": ["buy", "sell"]},
        "order_type": {"type": "string", "enum": ["market", "limit"]},
        "quantity": {"type": "number", "minimum": 0},
        "limit_price": {"type": ["number", "null"], "minimum": 0},
        "status": {
          "type": "string",
          "enum": ["proposed", "approved", "submitted", "filled", "canceled", "rejected"]
        },
        "decision_record_id": {"type": "string", "minLength": 1}
      }
    },
    "Execution": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "id",
        "order_id",
        "timestamp",
        "filled_quantity",
        "filled_price",
        "tx_hash",
        "fee_usd"
      ],
      "properties": {
        "id": {"type": "string", "minLength": 1},
        "order_id": {"type": "string", "minLength": 1},
        "timestamp": {"type": "string", "format": "date-time"},
        "filled_quantity": {"type": "number", "minimum": 0},
        "filled_price": {"type": "number", "minimum": 0},
        "tx_hash": {"type": "string", "minLength": 1},
        "fee_usd": {"type": "number", "minimum": 0}
      }
    },
    "Wallet": {
      "type": "object",
      "additionalProperties": false,
      "required": ["id", "address", "chain", "custody_type", "status", "policy_id"],
      "properties": {
        "id": {"type": "string", "minLength": 1},
        "address": {"type": "string", "minLength": 1},
        "chain": {"type": "string", "minLength": 1},
        "custody_type": {"type": "string", "enum": ["hot", "warm", "cold", "simulation"]},
        "status": {"type": "string", "enum": ["enabled", "disabled"]},
        "policy_id": {"type": "string", "minLength": 1}
      }
    },
    "RiskPolicy": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "id",
        "name",
        "max_position_usd",
        "max_daily_notional_usd",
        "max_market_exposure_pct",
        "stop_loss_pct",
        "requires_human_approval"
      ],
      "properties": {
        "id": {"type": "string", "minLength": 1},
        "name": {"type": "string", "minLength": 1},
        "max_position_usd": {"type": "number", "minimum": 0},
        "max_daily_notional_usd": {"type": "number", "minimum": 0},
        "max_market_exposure_pct": {"type": "number", "minimum": 0, "maximum": 1},
        "stop_loss_pct": {"type": "number", "minimum": 0, "maximum": 1},
        "requires_human_approval": {"type": "boolean"}
      }
    },
    "DecisionRecord": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "id",
        "market_id",
        "outcome_id",
        "thesis",
        "confidence",
        "evidence_refs",
        "proposed_action",
        "created_at",
        "created_by_agent"
      ],
      "properties": {
        "id": {"type": "string", "minLength": 1},
        "market_id": {"type": "string", "minLength": 1},
        "outcome_id": {"type": "string", "minLength": 1},
        "thesis": {"type": "string", "minLength": 1},
        "confidence": {"type": "number", "minimum": 0, "maximum": 1},
        "evidence_refs": {
          "type": "array",
          "items": {"type": "string", "minLength": 1}
        },
        "proposed_action": {
          "type": "string",
          "enum": ["hold", "buy", "sell", "reduce", "exit"]
        },
        "created_at": {"type": "string", "format": "date-time"},
        "created_by_agent": {"type": "string", "minLength": 1}
      }
    }
  }
}
